<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

 <link rel=stylesheet href="diary.css" media=all>

<link rel="alternate" type="application/rss+xml" title="RSS"
 href="rcl.rdf">
<title>くっつきＢＢＳスパム対策</title>
</head>
<body>

<a href="2006-08-18-8.html">Prev</a>


 / <a href="2006-08-19-2.html">Next</a>

/ <a href="index.html">あかぴのChangeLog by rchalow</a>
<h1>くっつきＢＢＳスパム対策[chalow]<br><TMPL_VAR name=cat></h1>
<div class="day">
<a href="2006-08-19.html">2006-08-19</a>
<div class="body">
<!-- start:2006-08-19-1 -->
<div class="section">
<h3 class="subtitle"><a name="2006-08-19-1" href="2006-08-19-1.html"><span class="sanchor">＊</span></a> <span class="clitemheader">くっつきＢＢＳスパム対策</span> [<a href="cat_chalow.html">chalow</a>]</h3>
<p></p><p>
<blockquote>### 書き込み<br>
if ($mode eq "write") {<br>
&nbsp;&nbsp;&nbsp;&nbsp;$name = $noname if ($name =~ /^\s*$/sm);<br>
</p><p>
+ ##### スパム対策 2006/08/19<br>
+ ##### <a href="http://www.pochi.cc/~sasaki/chalow/2006-01-25-2.html">http://www.pochi.cc/~sasaki/chalow/2006-01-25-2.html</a><br>
+ # anti spam<br>
+     if (($body ne "") &amp;&amp; ($body !~ m/[\x80-\xff]/)) {die('error')};<br>
+ #####<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if ($body !~ /\A\s*\Z/m) {<br>
escape_string(\$name);	<br>
escape_string(\$mail_or_url);	<br>
escape_string(\$body);<br>
</p><p>
$body =~ s/\r?\n/&lt;br>/gsm;<br>
</p><p>
my $name_tmp = $name;<br>
if ($mail_or_url =~ /^http:\/\/$URLCHARS+$/) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;$name_tmp = qq(&lt;a href="$mail_or_url">$name&lt;/a>);<br>
}<br>
</p><p>
$latest_id++;<br>
$com_hash{$latest_id}{n} = $name_tmp;<br>
$com_hash{$latest_id}{m} = $body;<br>
$com_hash{$latest_id}{d} = $what_time_is_it_now;<br>
</p><p>
+ ##### スパム対策 2006/08/19<br>
+ exit if (length($body) > 1000); # spam<br>
+ #####	<br>
</p><p>
write_to_logfile();	# ログファイルへの書き込み<br>
write_to_jsfile($fn_pref.".js"); # JavaScript Feed ファイルへの書き込み<br>
write_to_rssfile(); # RSS ファイルへの書き込み<br>
write_to_adminlogfile(); # 管理者用ログファイルへの書き込み<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>
</blockquote><br>
</p><p>

</p>

<div class="comment">
<div class="caption">［
<a href="2006-08-19-1.html">固定リンク</a> ｜
<a href="2006-08-19-1.html#disqus_thread">Comments (View)</a>
］</div>

</div>

<!--200608191-->
</div>
<!-- end:2006-08-19-1 -->
<!-- 広告とか -->



<div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/akapy/embed.js"></script><noscript><a href="http://akapy.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

</div></div>
<!--<p>last update: 2012-07-04 06:43</p>-->

</div>

<!-- Disqus -->
<script type="text/javascript">
//<![CDATA[
(function() {
		var links = document.getElementsByTagName('a');
		var query = '?';
		for(var i = 0; i < links.length; i++) {
			if(links[i].href.indexOf('#disqus_thread') >= 0) {
				query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
			}
		}
		document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/akapy/get_num_replies.js' + query + '"></' + 'script>');
	})();
//]]>
</script>
<!-- /Disqus -->
</body></html>
